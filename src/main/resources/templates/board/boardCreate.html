<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous">
    </script>
</head>
<body>
    <form method="post" action="/board/boardCreate">
        <label>제목입력</label>
        <br>
        <input type="text" name="title" placeholder="제목을 입력해주세요"required="required"/>
        <label>작성자</label>
        <span th:text="${accountContext.username}"/>
        <br>
        <label for="content">내용입력</label>
        <br>
        <textarea id="content" name="content" placeholder="내용을 작성하여 주세요" cols="100" rows="100" style="resize: vertical" required="required">
        </textarea>
        <div>
            <input name="uploadFiles" id="uploadFiles" type="file" multiple>
            <button class="uploadBtn">사진 업로드</button>
        </div>
        <div class="uploadResult">

        </div>
        <button type="submit">전송</button>
    </form>
    <script>
        function showUploadImages(arr){
            console.log(arr)
            var divArea=$(".uploadResult");

            var str="";

            for(var i=0; i<arr.length;i++){
                str+="<div>";
                str+="<img src='/display?fileName="+arr[i].thumbnailURL+"'>";
                str+="<button class='removeBtn' data-name='"+arr[i].imageURL+"'>사진 지우기</button>"
                str+="</div>"
                console.log(arr[i].thumbnailURL)
                console.log(divArea)
            }
            divArea.append(str);
        }

        $(".uploadBtn").click(function (e){
            e.preventDefault()
            let username = $("#username").val();

            console.log(username)

            var formData=new FormData();

            var inputFile=$("input[type='file']");

            var files=inputFile[0].files;

            for(var i=0; i< files.length; i++){
                console.log(files[i]);
                formData.append("uploadFiles",files[i]);
            }


            $.ajax({
                url:'/uploadBoard',
                processData:false,
                contentType:false,
                data: formData,
                type:'POST',
                dataType:'json',
                success:function (result){
                    console.log(result)
                    showUploadImages(result);
                },
                error:function (jqXHR,testStatus,errorThrown){
                    console.log(testStatus);
                }
            });
        });

        $(".uploadResult").on("click",".removeBtn",function (e){

            var target=$(this);
            var fileName=target.data("name");
            console.log(target.data("name"));
            var targetDiv=$(this).closest("div");

            console.log(fileName);

            $.post('/removeFile',{fileName:fileName},function (result){
                console.log(result)
                if(result==true){
                    targetDiv.remove();
                }
            })
            e.preventDefault()
        });
    </script>
</body>
</html>
</body>
</html>